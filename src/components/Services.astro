---
import XIcon from './icons/XIcon.astro';

// 1. A√ëAD√ç DESCRIPCIONES COMPLETAS (basadas en app/page.tsx)
const services = [
  { 
    icon: 'üè®', 
    title: 'Hospedajes Seleccionados', 
    desc: 'Alojamientos en ubicaciones estrat√©gicas',
    fullDesc: 'Hospedajes seleccionados en ubicaciones estrat√©gicas: casas, departamentos y caba√±as eco-amigables. Nos aseguramos de que cada lugar cumpla con nuestros est√°ndares de calidad y confort para que te sientas como en casa.'
  },
  { 
    icon: 'üöó', 
    title: 'Traslados Confiables', 
    desc: 'Veh√≠culos autorizados y profesionales',
    fullDesc: 'Contamos con veh√≠culos autorizados para todo tipo de necesidades: coches, 4x4, trafic y minib√∫s. Nuestros conductores profesionales garantizan tu seguridad y comodidad en cada trayecto.'
  },
  { 
    icon: '‚õ∞Ô∏è', 
    title: 'Experiencias Aut√©nticas', 
    desc: 'Aventuras que crean felicidad',
    fullDesc: 'Dise√±amos actividades personalizadas de aventura en la naturaleza mendocina. Desde parapente y rafting hasta kayak y tours de bodegas. Nos especializamos en crear momentos inolvidables.'
  }
];

---

<section id="servicios" class="py-20 bg-gray-50">
  <div class="container">
    <h2 class="text-center text-brand-orange mb-16">Nuestros Servicios Integrales</h2>
    <div class="grid md:grid-cols-3 gap-8">
      
      {services.map((svc, index) => (
        <button 
          class="service-card bg-white p-8 rounded-2xl shadow-lg hover:shadow-2xl text-left transition hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-brand-olive/50"
          data-index={index}
          aria-label={`Ver detalles de ${svc.title}`}
        >
          <div class="text-5xl mb-4">{svc.icon}</div>
          <h3 class="text-brand-orange mb-3">{svc.title}</h3>
          <p class="text-gray-600 text-sm">{svc.desc}</p>
        </button>
      ))}
    </div>
  </div>
</section>

<div id="service-modal-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden" aria-hidden="true"></div>

<div id="service-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="service-modal-title">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col">
    
    <div class="flex justify-between items-center p-6 border-b">
      <h2 id="service-modal-title" class="text-brand-orange text-2xl font-bold"></h2>
      <button id="service-modal-close-btn" class="text-gray-500 hover:text-gray-800 transition-colors" aria-label="Cerrar">
        <XIcon class="h-6 w-6" />
      </button>
    </div>

    <div class="p-6 md:p-8 overflow-y-auto">
      <div id="service-modal-icon" class="text-6xl mb-4"></div>
      <p id="service-modal-desc" class="text-gray-600 text-lg leading-relaxed"></p>
    </div>

    <div class="p-6 border-t border-gray-200 mt-auto bg-gray-50 rounded-b-2xl">
      <a href="#contacto" id="service-modal-contact-btn" class="btn btn-primary bg-brand-orange text-white hover:bg-brand-orange/90 w-full text-center">
        Consultar por este servicio
      </a>
    </div>
  </div>
</div>

<script define:vars={{ servicesData: services }}>
  // Pasamos los datos de Astro al script
  const services = servicesData;

  // --- Elementos del DOM ---
  const backdrop = document.getElementById('service-modal-backdrop');
  const modal = document.getElementById('service-modal');
  const closeBtn = document.getElementById('service-modal-close-btn');
  const contactBtn = document.getElementById('service-modal-contact-btn');
  const cards = document.querySelectorAll('.service-card');
  
  // --- Elementos de contenido ---
  const modalTitle = document.getElementById('service-modal-title');
  const modalIcon = document.getElementById('service-modal-icon');
  const modalDesc = document.getElementById('service-modal-desc');

  function openModal(index) {
    const svc = services[index];
    if (!svc) return;

    // 1. Rellenar contenido
    modalTitle.textContent = svc.title;
    modalIcon.textContent = svc.icon;
    modalDesc.textContent = svc.fullDesc;

    // 2. Mostrar modal
    backdrop.classList.remove('hidden');
    modal.classList.remove('hidden');
    modal.classList.add('flex'); // Usamos flex para centrar
    document.body.style.overflow = 'hidden'; // Evitar scroll
  }

  function closeModal() {
    backdrop.classList.add('hidden');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = ''; // Restaurar scroll
  }

  // --- Event Listeners ---

  // Abrir modal
  cards.forEach(card => {
    card.addEventListener('click', () => {
      const index = card.getAttribute('data-index');
      openModal(index);
    });
  });

  // Cerrar modal
  closeBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', closeModal);
  contactBtn.addEventListener('click', closeModal); 

  // Cerrar con tecla Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });
</script>