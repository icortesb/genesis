---
import { Image } from 'astro:assets';

// Importamos las im√°genes
import imgParapente from '../../public/parapente.png';
import imgRafting from '../../public/rafting.png';
import imgKayak from '../../public/kayak.png';

// 1. A√ëAD√ç DATOS DETALLADOS PARA EL MODAL
const experiences = [
  { 
    title: 'Parapente en T√°ndem', 
    desc: 'Vuelo sobre los Andes con fotos HD, vino y certificado', 
    price: 'desde $120.000',
    image: imgParapente,
    alt: 'Dos personas volando en parapente t√°ndem sobre las monta√±as de Mendoza',
    // --- NUEVOS DATOS ---
    details: {
      main: 'Vuelo inolvidable sobre el pedemonte mendocino con vistas espectaculares de la Cordillera de los Andes.',
      options: [
        'üìç Despegue: Cerro Arco (subida en 4x4)',
        '‚úàÔ∏è Vuelo Cl√°sico: 15-20 min. - $120.000',
        '‚úàÔ∏è Vuelo Extendido: 40-45 min. - $180.000',
        '‚õ∞Ô∏è Hike and Fly: $190.000'
      ],
      includes: [
        'Pilotos certificados (+15 a√±os de exp.)',
        'Fotos y video en HD',
        'Traslado ida y vuelta',
        'Vino de cortes√≠a y certificado'
      ],
      note: '',
      quote: '"No est√°s pagando por un vuelo‚Ä¶ est√°s invirtiendo en una historia que vas a contar toda tu vida"'
    }
  },
  { 
    title: 'Rafting R√≠o Mendoza', 
    desc: 'Descenso clase II-III con gu√≠a profesional y equipo', 
    price: '$54.000',
    image: imgRafting,
    alt: 'Grupos de personas haciendo rafting en los r√°pidos del R√≠o Mendoza',
    // --- NUEVOS DATOS ---
    details: {
      main: 'Descenso deportivo en el R√≠o Mendoza. Dificultad Clase II-III+ (Media/Alta, m√°xima en verano).',
      options: [
        '‚è±Ô∏è Duraci√≥n: 2 horas total (1 hora navegaci√≥n)',
        'üíß Tarifa: $54.000 por persona'
      ],
      includes: [
        'Equipo completo (traje, chaqueta, calzado neoprene, casco, chaleco)',
        'Gu√≠a profesional biling√ºe',
        'Seguro contra accidentes personales',
        'Base con duchas, lockers, cambiadores'
      ],
      note: 'Nota: Alquiler de toallones $1.500',
      quote: ''
    }
  },
  { 
    title: 'Kayak Dique Potrerillos', 
    desc: 'Actividad placentera en aguas tranquilas con gu√≠a', 
    price: '$54.000',
    image: imgKayak,
    alt: 'Dos personas en un kayak en un lago con monta√±as al fondo',
    // --- NUEVOS DATOS ---
    details: {
      main: 'Actividad acu√°tica placentera en el lago. Experiencia relajante rodeada de monta√±as.',
      options: [
        '‚è±Ô∏è Duraci√≥n: 2 horas',
        'üö£ Tarifa: $54.000 por persona'
      ],
      includes: [
        'Equipo completo',
        'Traslado al perilago',
        'Gu√≠a profesional'
      ],
      note: 'Ideal para familias y grupos',
      quote: ''
    }
  }
];

// Icono 'X' para el bot√≥n de cerrar
const xIcon = `
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6">
  <line x1="18" y1="6" x2="6" y2="18"></line>
  <line x1="6" y1="6" x2="18" y2="18"></line>
</svg>
`;
---

<section id="experiencias" class="py-20">
  <div class="container">
    <h2 class="text-center text-wine mb-16">Experiencias Destacadas</h2>
    <div class="grid md:grid-cols-3 gap-8">
      
      {experiences.map((exp, index) => (
        <button 
          class="experience-card bg-white rounded-2xl shadow-lg hover:shadow-2xl overflow-hidden text-left transition hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-olive/50"
          data-index={index}
          aria-label={`Ver detalles de ${exp.title}`}
        >
          <Image 
            src={exp.image} 
            alt={exp.alt} 
            class="w-full h-48 object-cover pointer-events-none"
            widths={[400]}
            sizes="(max-width: 768px) 100vw, 33vw"
            loading="lazy"
          />
          <div class="p-6">
            <h3 class="text-wine mb-2 text-lg">{exp.title}</h3>
            <p class="text-gray-600 text-sm mb-4">{exp.desc}</p>
            <p class="text-olive font-bold">{exp.price}</p>
          </div>
        </button>
      ))}
    </div>
  </div>
</section>

<div id="modal-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden" aria-hidden="true"></div>

<div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
    
    <div class="relative">
      <Image 
        id="modal-image" 
        src={experiences[0].image} 
        alt="" 
        class="w-full h-48 md:h-64 object-cover rounded-t-2xl" 
        width="600"
        height="256"
      />
      <button id="modal-close-btn" class="absolute top-4 right-4 bg-white/70 rounded-full p-2 text-gray-800 hover:bg-white transition-all" aria-label="Cerrar">
        <Fragment set:html={xIcon} />
      </button>
    </div>

    <div class="p-6 md:p-8 overflow-y-auto">
      <h2 id="modal-title" class="text-wine text-3xl font-bold mb-4"></h2>
      <p id="modal-main-desc" class="text-gray-600 mb-6 text-lg"></p>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="font-bold text-gray-800 mb-3">Opciones y Precios</h4>
          <ul id="modal-options" class="space-y-2 text-sm text-gray-600">
            </ul>
        </div>
        
        <div>
          <h4 class="font-bold text-gray-800 mb-3">Incluye</h4>
          <ul id="modal-includes" class="space-y-2 text-sm text-gray-600">
            </ul>
        </div>
      </div>

      <p id="modal-note" class="text-sm text-gray-500 italic mt-6"></p>
      <p id="modal-quote" class="text-base text-olive italic mt-6 font-semibold text-center border-t border-b border-gray-200 py-4"></p>
    </div>

    <div class="p-6 border-t border-gray-200 mt-auto bg-gray-50 rounded-b-2xl">
      <a href="#contacto" id="modal-contact-btn" class="btn btn-primary w-full text-center">
        Reservar esta experiencia
      </a>
    </div>
  </div>
</div>


<script define:vars={{ experiencesData: experiences }}>
  // Pasamos los datos de Astro al script del cliente
  const experiences = experiencesData;

  // --- Elementos del DOM ---
  const modalBackdrop = document.getElementById('modal-backdrop');
  const modal = document.getElementById('modal');
  const modalCloseBtn = document.getElementById('modal-close-btn');
  const modalContactBtn = document.getElementById('modal-contact-btn');
  const experienceCards = document.querySelectorAll('.experience-card');
  
  // --- Elementos de contenido del modal ---
  const modalTitle = document.getElementById('modal-title');
  const modalImage = document.getElementById('modal-image');
  const modalMainDesc = document.getElementById('modal-main-desc');
  const modalOptionsList = document.getElementById('modal-options');
  const modalIncludesList = document.getElementById('modal-includes');
  const modalNote = document.getElementById('modal-note');
  const modalQuote = document.getElementById('modal-quote');

  function openModal(index) {
    const exp = experiences[index];
    if (!exp) return;

    // 1. Rellenar contenido
    modalTitle.textContent = exp.title;
    // La ruta de la imagen ya est√° procesada por Astro
    modalImage.src = exp.image.src; 
    modalImage.alt = exp.alt;
    modalMainDesc.textContent = exp.details.main;
    
    // 2. Rellenar listas (borrando las anteriores)
    modalOptionsList.innerHTML = '';
    exp.details.options.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      modalOptionsList.appendChild(li);
    });

    modalIncludesList.innerHTML = '';
    exp.details.includes.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `‚úì ${item}`; // A√±adimos un tick
      modalIncludesList.appendChild(li);
    });

    // 3. Rellenar nota y cita (y ocultarlos si no existen)
    if (exp.details.note) {
      modalNote.textContent = exp.details.note;
      modalNote.classList.remove('hidden');
    } else {
      modalNote.classList.add('hidden');
    }

    if (exp.details.quote) {
      modalQuote.textContent = exp.details.quote;
      modalQuote.classList.remove('hidden');
    } else {
      modalQuote.classList.add('hidden');
    }

    // 4. Mostrar modal
    modalBackdrop.classList.remove('hidden');
    modal.classList.remove('hidden');
    modal.classList.add('flex'); // Usamos flex para centrar
    document.body.style.overflow = 'hidden'; // Evitar scroll del fondo
  }

  function closeModal() {
    modalBackdrop.classList.add('hidden');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = ''; // Restaurar scroll
  }

  // --- Event Listeners ---

  // Abrir modal al hacer clic en una card
  experienceCards.forEach(card => {
    card.addEventListener('click', () => {
      const index = card.getAttribute('data-index');
      openModal(index);
    });
  });

  // Cerrar modal
  modalCloseBtn.addEventListener('click', closeModal);
  modalBackdrop.addEventListener('click', closeModal);
  
  // Tambi√©n cerramos el modal si hacen clic en "Reservar"
  modalContactBtn.addEventListener('click', closeModal); 

  // Cerrar con tecla Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });

</script>

<style>
  .wine { color: var(--wine); }
  .olive { color: var(--olive); }
  /* A√±adimos cursor pointer a las cards */
  .experience-card {
    cursor: pointer;
  }
</style>