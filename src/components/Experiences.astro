---
import { Image } from 'astro:assets';
import XIcon from './icons/XIcon.astro';

// Importamos las im√°genes
import imgParapente from '../../public/parapente.jpg';
import imgRafting from '../../public/rafting.png';
import imgKayak from '../../public/kayak.png';
// NOTA: Agrega una imagen para el tour de bodegas en `public/` y actualiza la siguiente l√≠nea.
// Por ahora, usamos la imagen de parapente como placeholder.
import imgBodega from '../../public/bodega.jpg';
import imgTrekking from '../../public/trekking.png'; //
import imgCabalgata from '../../public/cabalgata.png'; //
import imgAcuaticas from '../../public/standuppaddle.png'; //
import imgPanoramicas from '../../public/experiencia-acon.png'; // Placeholder, usa una imagen apropiada

const experiences = [
  {
    title: 'Experiencia Enol√≥gica en Mendoza',
    desc: 'Viv√≠ Mendoza a trav√©s de sus vinos, gastronom√≠a y paisajes √∫nicos.',
    image: imgBodega, // Placeholder, actualiza con una imagen de bodegas.
    alt: 'Copa de vino con vi√±edos y monta√±as de fondo en Mendoza',
    details: {
      main: 'Una experiencia enol√≥gica integral que te invita a recorrer las principales regiones vitivin√≠colas, visitando bodegas seleccionadas, degustando vinos de alta calidad y disfrutando de almuerzos maridados al pie de la Cordillera de los Andes.',
      options: [
        'üçá Regiones: Luj√°n de Cuyo, Maip√∫ y Valle de Uco.',
        'üç∑ Visitas y degustaciones guiadas en bodegas con identidad propia.',
        'üçΩÔ∏è Almuerzos maridados de varios pasos en restaurantes de bodega.',
        'ü´í Visitas opcionales a oliv√≠colas y destiler√≠as artesanales.'
      ],
      includes: [
        'Recorridos por las principales zonas vitivin√≠colas.',
        'Degustaciones de vinos de alta calidad.',
        'Almuerzos en bodega con maridaje.',
        'Gu√≠as especializados en vino.'
      ],
      note: 'Cada experiencia es cuidadosamente planificada seg√∫n disponibilidad, buscando siempre el mejor itinerario posible.',
      quote: 'Una inmersi√≥n completa en la cultura del vino mendocino, combinando tradici√≥n, innovaci√≥n y sabores aut√©nticos.'
    }
  },
  { 
    title: 'Parapente en T√°ndem', 
    desc: 'Vuelo sobre Pedemonte Mendocino con fotos HD, vino y certificado', 
    image: imgParapente,
    alt: 'Dos personas volando en parapente t√°ndem sobre las monta√±as de Mendoza',
    details: {
      main: 'Vuelo inolvidable sobre el pedemonte mendocino con vistas espectaculares de la Cordillera de los Andes.',
      options: [
        'üìç Despegue: Cerro Arco (incluye subida en 4x4)',
        '‚úàÔ∏è Vuelo Cl√°sico: 15-20 min.',
        '‚úàÔ∏è Vuelo Extendido: 40-45 min.',
        '‚õ∞Ô∏è Hike and Fly'
      ],
      includes: [
        'Pilotos certificados (+15 a√±os de exp.)',
        'Fotos y video en HD',
        'Traslado ida y vuelta',
        'Vino de cortes√≠a y certificado'
      ],
      note: '',
      quote: '"No est√°s pagando por un vuelo‚Ä¶ est√°s invirtiendo en una historia que vas a contar toda tu vida"'
    }
  },
  { 
    title: 'Rafting R√≠o Mendoza', 
    desc: 'Descenso clase II-III con gu√≠a profesional y equipo', 
    image: imgRafting,
    alt: 'Grupos de personas haciendo rafting en los r√°pidos del R√≠o Mendoza',
    details: {
      main: 'Descenso deportivo en el R√≠o Mendoza. Dificultad Clase II-III+ (Media/Alta, m√°xima en verano).',
      options: [
        '‚è±Ô∏è Duraci√≥n total: 2 horas',
        '‚è±Ô∏è Tiempo de navegaci√≥n: 1 hora'
      ],
      includes: [
        'Equipo completo (traje, chaqueta, calzado neoprene, casco, chaleco)',
        'Gu√≠a profesional biling√ºe',
        'Seguro contra accidentes personales',
        'Base con duchas, lockers, cambiadores'
      ],
      note: '',
      quote: ''
    }
  },
  { 
    title: 'Aventura y Adrenalina', 
    desc: 'Experiencias para quienes buscan emociones fuertes y una dosis extra de adrenalina.', 
    image: imgBodega, // Placeholder, usa una imagen apropiada
    alt: 'Persona haciendo canopy en la monta√±a',
    details: {
      main: 'Experiencias pensadas para quienes buscan emociones fuertes y una dosis extra de adrenalina en entornos naturales √∫nicos de Mendoza. Actividades guiadas y seguras que combinan altura, velocidad y paisajes inolvidables.',
      options: [
        'üèûÔ∏è Canopy: Circuitos de tirolesas que atraviesan monta√±as y r√≠os, permitiendo volar sobre el paisaje mendocino.',
        'ü™Ç Paracaidismo: Salto en t√°ndem para experimentar la ca√≠da libre y el vuelo en paraca√≠das, con vistas espectaculares.'
      ],
      includes: [
        'Gu√≠as profesionales y certificados',
        'Equipamiento de seguridad completo',
        'Registro audiovisual (en Paracaidismo)'
      ],
      note: 'Actividades sujetas a condiciones clim√°ticas.',
      quote: 'Ideales para vivir la monta√±a desde otra perspectiva.'
    }
  },
  {
    title: 'Trekking en la Cordillera',
    desc: 'Caminatas guiadas por paisajes imponentes y senderos naturales √∫nicos.',
    image: imgTrekking, // Recuerda cambiar esta imagen
    alt: 'Persona haciendo trekking en un sendero de monta√±a con un valle de fondo',
    details: {
      main: 'Descubr√≠ la magia de la monta√±a mendocina a trav√©s de caminatas guiadas. Cada recorrido invita a conectar con la naturaleza, respirar aire puro y disfrutar de vistas inolvidables, combinando aventura, historia y geograf√≠a andina.',
      options: [
        'üìç Potrerillos: Senderos con vistas al Dique y al Cord√≥n del Plata.',
        'üìç Uspallata: Caminatas entre cerros multicolores y cascadas.',
        'üìç Precordillera: Recorridos de naturaleza y patrimonio hist√≥rico.'
      ],
      includes: [
        'Gu√≠a profesional de trekking',
        'Seguro de accidentes personales',
        'Botiqu√≠n de primeros auxilios'
      ],
      note: 'Se recomienda llevar calzado c√≥modo, protector solar y agua.',
      quote: 'Una experiencia ideal para quienes desean explorar la cordillera de una manera activa y segura.'
    }
  }
  ,
  {
    title: 'Cabalgatas en Mendoza',
    desc: 'Una forma tradicional y relajada de disfrutar la naturaleza.',
    image: imgCabalgata, // Recuerda cambiar esta imagen
    alt: 'Grupo de personas a caballo en un paisaje de monta√±a',
    details: {
      main: 'Viv√≠ una experiencia aut√©ntica recorriendo paisajes mendocinos a caballo. Las cabalgatas permiten conocer entornos rurales y de monta√±a, conectar con la cultura local y saborear la tranquilidad del campo.',
      options: [
        'üìç Luj√°n de Cuyo: Cabalgatas criollas en un entorno natural privilegiado.',
        'üìç Zonas rurales de monta√±a: Experiencias camperas que recrean la vida del gaucho.',
        'üìç Cabalgatas al atardecer: Recorridos especiales para disfrutar los colores del sol sobre la cordillera.'
      ],
      includes: [
        'Gu√≠a especializado',
        'Caballos mansos y equipados',
        'Seguro de accidentes personales'
      ],
      note: 'Propuestas pensadas para disfrutar en pareja, en familia o con amigos.',
      quote: 'Una forma tradicional y relajada de disfrutar la naturaleza.'
    }
  },
  {
    title: 'Experiencias Acu√°ticas',
    desc: 'Disfruta del agua y los paisajes de monta√±a de una forma relajada y divertida.',
    image: imgAcuaticas, // Recuerda cambiar esta imagen
    alt: 'Persona haciendo Stand Up Paddle en un lago con monta√±as',
    details: {
      main: 'Propuestas ideales para disfrutar del agua y los paisajes de monta√±a de una forma relajada y divertida. Actividades guiadas pensadas para todas las edades, en entornos naturales de gran belleza.',
      options: [
        'üö£ Kayak en el Dique Potrerillos: Actividad placentera en aguas tranquilas con gu√≠a. Duraci√≥n: 2 horas.',
        'üèÑ Stand Up Paddle: Navegaci√≥n sobre aguas tranquilas en el Dique Potrerillos, rodeado de monta√±as.',
        '‚õµ Paseo en Velero: Experiencia de navegaci√≥n relajada para disfrutar del embalse y sus vistas panor√°micas.'
      ],
      includes: [
        'Gu√≠a profesional',
        'Equipamiento completo',
        'Traslado al perilago (en Kayak)',
        'Seguro de accidentes personales'
      ],
      note: 'Actividades ideales para familias y grupos.',
      quote: 'Una forma diferente de conectar con el agua y la monta√±a.'
    }
  },
  {
    title: 'Experiencias Panor√°micas y Exclusivas',
    desc: 'Vivencias para disfrutar Mendoza desde una perspectiva diferente, combinando paisajes √∫nicos y comodidad.',
    image: imgPanoramicas, // Recuerda cambiar esta imagen
    alt: 'Vista panor√°mica de la cordillera de los Andes desde un helic√≥ptero',
    details: {
      main: 'Vivencias pensadas para quienes buscan disfrutar Mendoza desde una perspectiva diferente, combinando paisajes √∫nicos, comodidad y momentos especiales. Ideales para celebraciones, viajes en pareja o experiencias premium.',
      options: [
        'üöÅ Vuelo en Helic√≥ptero: Sobrevuelo panor√°mico del Dique Potrerillos y la cordillera.',
        'üèîÔ∏è Experiencia Aconcagua: Excursi√≥n completa al coraz√≥n de los Andes, visitando paisajes ic√≥nicos y puntos emblem√°ticos.'
      ],
      includes: [
        'Gu√≠a especializado',
        'Transporte premium',
        'Servicio exclusivo y personalizado'
      ],
      note: 'Ideales para celebraciones, viajes en pareja o experiencias premium.',
      quote: 'Una perspectiva √∫nica de los paisajes m√°s imponentes de Mendoza.'
    }
  }
];

---

<section id="experiencias" class="py-20">
  <div class="container">
    <h2 class="text-center text-brand-orange mb-16">Experiencias Destacadas</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
      
      {experiences.map((exp, index) => (
        <button 
          class="experience-card bg-white rounded-2xl shadow-lg hover:shadow-2xl overflow-hidden text-left transition hover:-translate-y-1 focus:outline-none focus:ring-4 focus:ring-brand-olive/50"
          data-index={index}
          aria-label={`Ver detalles de ${exp.title}`}
        >
          <Image 
            src={exp.image} 
            alt={exp.alt} 
            class="w-full h-48 object-cover pointer-events-none"
            widths={[400]}
            sizes="(max-width: 768px) 100vw, 33vw"
            loading="lazy"
          />
          <div class="p-6">
            <h3 class="text-brand-orange mb-2 text-lg">{exp.title}</h3>
            <p class="text-gray-600 text-sm mb-4">{exp.desc}</p>
          </div>
        </button>
      ))}
    </div>
  </div>
</section>

<div id="modal-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden" aria-hidden="true"></div>

<div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
    
    <div class="relative">
      <Image 
        id="modal-image" 
        src={experiences[0].image} 
        alt="" 
        class="w-full h-48 md:h-64 object-cover rounded-t-2xl" 
        width="600"
        height="256"
      />
      <button id="modal-close-btn" class="absolute top-4 right-4 bg-white/70 rounded-full p-2 text-gray-800 hover:bg-white transition-all" aria-label="Cerrar">
        <XIcon class="h-6 w-6" />
      </button>
    </div>

    <div class="p-6 md:p-8 overflow-y-auto">
      <h2 id="modal-title" class="text-brand-orange text-3xl font-bold mb-4"></h2>
      <p id="modal-main-desc" class="text-gray-600 mb-6 text-lg"></p>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="font-bold text-gray-800 mb-3">Opciones y Tiempos</h4>
          <ul id="modal-options" class="space-y-2 text-sm text-gray-600">
            </ul>
        </div>
        
        <div>
          <h4 class="font-bold text-gray-800 mb-3">Incluye</h4>
          <ul id="modal-includes" class="space-y-2 text-sm text-gray-600">
            </ul>
        </div>
      </div>

      <p id="modal-note" class="text-sm text-gray-500 italic mt-6"></p>
      <p id="modal-quote" class="text-base text-brand-olive italic mt-6 font-semibold text-center border-t border-b border-gray-200 py-4"></p>
    </div>

    <div class="p-6 border-t border-gray-200 mt-auto bg-gray-50 rounded-b-2xl">
      <a href="#contacto" id="modal-contact-btn" class="btn btn-primary bg-brand-orange text-white hover:bg-brand-orange/90 w-full text-center">
        Reservar esta experiencia
      </a>
    </div>
  </div>
</div>


<script define:vars={{ experiencesData: experiences }}>
  // Pasamos los datos de Astro al cliente
  const experiences = experiencesData;

  // --- Elementos del DOM ---
  const modalBackdrop = document.getElementById('modal-backdrop');
  const modal = document.getElementById('modal');
  const modalCloseBtn = document.getElementById('modal-close-btn');
  const modalContactBtn = document.getElementById('modal-contact-btn');
  const experienceCards = document.querySelectorAll('.experience-card');
  
  // --- Elementos de contenido del modal ---
  const modalTitle = document.getElementById('modal-title');
  const modalImage = document.getElementById('modal-image');
  const modalMainDesc = document.getElementById('modal-main-desc');
  const modalOptionsList = document.getElementById('modal-options');
  const modalIncludesList = document.getElementById('modal-includes');
  const modalNote = document.getElementById('modal-note');
  const modalQuote = document.getElementById('modal-quote');

  function openModal(index) {
    const exp = experiences[index];
    if (!exp) return;

    // 1. Rellenar contenido
    modalTitle.textContent = exp.title;
    modalImage.src = exp.image.src; 
    modalImage.alt = exp.alt;
    modalMainDesc.textContent = exp.details.main;
    
    // 2. Rellenar listas (borrando las anteriores)
    modalOptionsList.innerHTML = '';
    exp.details.options.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      modalOptionsList.appendChild(li);
    });

    modalIncludesList.innerHTML = '';
    exp.details.includes.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `‚úì ${item}`; // A√±adimos un tick
      modalIncludesList.appendChild(li);
    });

    // 3. Rellenar nota y cita (y ocultarlos si no existen)
    if (exp.details.note) {
      modalNote.textContent = exp.details.note;
      modalNote.classList.remove('hidden');
    } else {
      modalNote.classList.add('hidden');
    }

    if (exp.details.quote) {
      modalQuote.textContent = exp.details.quote;
      modalQuote.classList.remove('hidden');
    } else {
      modalQuote.classList.add('hidden');
    }

    // 4. Mostrar modal
    modalBackdrop.classList.remove('hidden');
    modal.classList.remove('hidden');
    modal.classList.add('flex'); // Usamos flex para centrar
    document.body.style.overflow = 'hidden'; // Evitar scroll del fondo
  }

  function closeModal() {
    modalBackdrop.classList.add('hidden');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = ''; // Restaurar scroll
  }

  // --- Event Listeners ---

  // Abrir modal al hacer clic en una card
  experienceCards.forEach(card => {
    card.addEventListener('click', () => {
      const index = card.getAttribute('data-index');
      openModal(parseInt(index, 10));
    });
  });

  // Cerrar modal
  modalCloseBtn.addEventListener('click', closeModal);
  modalBackdrop.addEventListener('click', closeModal);
  
  // Tambi√©n cerramos el modal si hacen clic en "Reservar"
  modalContactBtn.addEventListener('click', closeModal); 

  // Cerrar con tecla Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });

</script>
